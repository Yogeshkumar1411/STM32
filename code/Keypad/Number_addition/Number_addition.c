#include<stm32f10x.h>
void delay(unsigned int ms)
{
	while(ms--);
}
char seg[20]={0X3F,0X06,0X5B,0X4F,0X66,0X6D,0X7D,0X07,0X7F,0X6F};
char a[10];
int i=0;
int sum=0,b,c;
int main()
{
	RCC->APB2ENR=1<<2|1<<4;
	GPIOA->CRL=0X22222222;
	GPIOA->CRH=0X08882222;
	GPIOC->CRH=0X08800000;
	while(1)
	{
		GPIOA->IDR=1<<8;
		GPIOA->BRR=1<<9|1<<10|1<<11;
		if(GPIOA->IDR&1<<12)
		{
			a[i]=1;
			i++;
			GPIOA->ODR|=seg[1];
			delay(65000);
			GPIOA->BRR|=seg[1];
			delay(65000);
			while(GPIOA->IDR&1<<12);
		}
	if(GPIOA->IDR&1<<13)
		{
			a[i]=2;
			i++;
			GPIOA->ODR|=seg[2];
			delay(65000);
			GPIOA->BRR|=seg[2];
			delay(65000);
			while(GPIOA->IDR&1<<13);
		}
		if(GPIOA->IDR&1<<14)
		{
			a[i]=3;
			i++;
			GPIOA->ODR|=seg[3];
			delay(65000);
			GPIOA->BRR|=seg[3];
			delay(65000);
			while(GPIOA->IDR&1<<14);
		}
		
		
		
		GPIOA->IDR=1<<9;
		GPIOA->BRR=1<<8|1<<10|1<<11;
		if(GPIOA->IDR&1<<12)
		{
			a[i]=4;
			i++;
			GPIOA->ODR|=seg[4];
			delay(65000);
			GPIOA->BRR|=seg[4];
			delay(65000);
			while(GPIOA->IDR&1<<12);
		}
		if(GPIOA->IDR&1<<13)
		{
			a[i]=5;
			i++;
			GPIOA->ODR|=seg[5];
			delay(65000);
			GPIOA->BRR|=seg[5];
			delay(65000);
			while(GPIOA->IDR&1<<13);
		}
		if(GPIOA->IDR&1<<14)
		{
			a[i]=6;
			i++;
			GPIOA->ODR|=seg[6];
			delay(65000);
			GPIOA->BRR|=seg[6];
			delay(65000);
			while(GPIOA->IDR&1<<14);
		}
			
		
		GPIOA->IDR=1<<10;
		GPIOA->BRR=1<<9|1<<8|1<<11;
		if(GPIOA->IDR&1<<12)
		{
			a[i]=7;
			i++;
			GPIOA->ODR|=seg[7];
			delay(65000);
			GPIOA->BRR|=seg[7];
			delay(65000);
			while(GPIOA->IDR&1<<12);
		}
		if(GPIOA->IDR&1<<13)
		{
			a[i]=8;
			i++;
			GPIOA->ODR|=seg[8];
			delay(65000);
			GPIOA->BRR|=seg[8];
			delay(65000);
			while(GPIOA->IDR&1<<13);
		}
		if(GPIOA->IDR&1<<14)
		{
			a[i]=9;
			i++;
			GPIOA->ODR|=seg[9];
			delay(65000);
			GPIOA->BRR|=seg[9];
			delay(65000);
			while(GPIOA->IDR&1<<14);
		}
		
		
		GPIOA->IDR=1<<11;
		GPIOA->BRR=1<<9|1<<10|1<<8;
		if(GPIOA->IDR&1<<12)
		{
			sum=a[0]+a[1];
			b=sum/10;
			c=sum%10;
			GPIOC->BRR|=1<<14;
			GPIOC->ODR|=1<<13;
			GPIOA->ODR|=seg[b];
			delay(65000);
			GPIOA->BRR|=seg[b];
			delay(65000);
			GPIOC->BRR|=1<<13;
			GPIOC->ODR|=1<<14;
			GPIOA->ODR|=seg[c];
			delay(65000);
			GPIOA->BRR|=seg[c];
			delay(65000);			
		}
		if(GPIOA->IDR&1<<13)
		{
			a[i]=0;
			i++;
			GPIOA->ODR|=seg[0];
			delay(65000);
			GPIOA->BRR|=seg[0];
			delay(65000);
			while(GPIOA->IDR&1<<13);
		}
		if(GPIOA->IDR&1<<14)
		{
			i=0;
		}
	}
}
